  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>EssAI Mockup</title>

    <link rel="stylesheet" href="static/css/main.css" />

  </head>
  <body>
    <div class="chart">

      <h1>EssAi Mockup</h1>
      <br>
    </div>
    <h4>Select Metric</h4>
      <button onclick="changeSentenceOrder('index')">Order by Appearance</button>
      <br>
      <button onclick="changeSentenceOrder('ProbabilityRank')">Order by Probability</button>
      <br>



      <div id="chart"></div>
      <div class="chart-footer">



        <br />

      </div>
    </div>




    <br>
    <br>
    <div id="my_dataviz"></div>



    <script src="https://d3js.org/d3.v4.js"></script>
    <script>

      var width = 800,
          height = 500,
          defaultOpacity = 0.4;

      var svg = d3.select("#chart")
        .append("svg")
        .attr("width", width)
        .attr("height", height);


      var fontSize = 18;
      var spaceSize = 2;

      function changeSentenceOrder(column){
        d3.selectAll(".user_sentences")
          .transition()
          .duration(800)
          .ease(d3.easeLinear)
          .attr("y", function(d, i){
            return (d[column]  * (fontSize + spaceSize));
          });
      }


      d3.json("static/data/scatter.json", function (myData) {

        //=========================================================================
        // Properly cast all incoming values
        //=========================================================================
        myData.forEach(function(d){
          d.Author = d.Author;
          d.Text = d.Text;
          d.index =  +d.index;
          d.ProbabilityRank =  +d.ProbabilityRank;
          d.sentenceLengthByChar = +d.sentenceLengthByChar;
          d.shannonEntropy = +d.shannonEntropy;
          d.Probability = +d.Probability;
        })

        //=========================================================================
        // Set Dimensions
        //=========================================================================

        var margin = { top: 30, right: 180, bottom: 50, left: 60 },
          iwidth = width - margin.left - margin.right,
          iheight = height - margin.top - margin.bottom
          axisLabelShift = 40;

        //=========================================================================
        // gDrawing
        //=========================================================================

        var gDrawing = svg
          .append("g")
          .attr("transform", `translate(${margin.left}, ${margin.top})`);

        //=========================================================================
        // Generate Text List
        //=========================================================================

        var colorScale = d3
          .scaleLinear()
          .domain([0, 100])
          .range(["red", "green"]);

        var scatter = gDrawing
          .append('g')
          .selectAll("text")
          .data(myData)
          .enter()
          .filter(function(d) { return d.Author == "User";})
          .append("text")
          .attr("class", "user_sentences")
          .text(function(d) {return d.Text; })
          .attr("x", 10) 
          .attr("y", function(d, i) {
            return (i * (fontSize + spaceSize));
          })
          .attr("fill", function(d, i){
            return colorScale(d.Probability);
          });

      });

    </script>
    <!-- <script src="static/js/main.js"></script> -->





    <script>
      // set the dimensions and margins of the graph
      var margin_box = {top: 10, right: 30, bottom: 30, left: 40},
        width_box = 660 - margin_box.left - margin_box.right,
        height_box = 400 - margin_box.top - margin_box.bottom;

     // append the svg object to the body of the page
      var box = d3
      .select("#my_dataviz")
      .append("svg")
      .attr("width", width_box + margin_box.left + margin_box.right)
      .attr("height", height_box + margin_box.top + margin_box.bottom)
      .append("g")
      .attr("transform", "translate(" + margin_box.left + "," + margin_box.top + ")");


      d3.json("static/data/ScottFitzgerald_top5.json", function(orig_data) {


            let intermediate_dict = {};

            // First transform the data into the format we want ----
            // Credit to Zak Whittington for this code.
            function transform (orig_data){

              for (const orig_obj of orig_data) {
                if (! (orig_obj.Metric in intermediate_dict))
                  intermediate_dict[orig_obj.Metric] = {};
                  intermediate_dict[orig_obj.Metric][orig_obj.Statistic] = orig_obj.Value;
                }
              console.log(intermediate_dict);
              let sumstat = [];
              for (const [key, val] of Object.entries(intermediate_dict)) {
                sumstat.push({
                  key: key,
                  value: val,
                });
              }
             console.log(sumstat);
              return sumstat;
          }

          var sumstat = transform(orig_data);


      var button = d3.select("#my_dataviz").append('select');

      button // Add a button
        .selectAll('myOptions') // Next 4 lines add 6 options = 6 colors
        .data(Object.keys(intermediate_dict))
        .enter()
        .append('option')
        .text(function (d) { return d; }) // text showed in the menu
        .attr("value", function (d) { return d; }) ;


          // Show the X scale
          var x = d3.scaleBand()
            .range([ 0, width_box])
            .domain(Object.keys(intermediate_dict))
            .paddingInner(1)
            .paddingOuter(.5);

            box.append("g")
            .attr("transform", "translate(0," + height_box + ")")
            .call(d3.axisBottom(x));

            var max_val = 0;
            for(const obj of orig_data){
              if(obj.Value > max_val){
                max_val = obj.Value;
              }
            }
 
            console.log(max_val);

            // Show the Y scale
            var y = d3.scaleLinear()
              .domain([0, max_val])
              .range([height_box, 0]);

            box.append("g").call(d3.axisLeft(y))

          function genGraph (sumstat){


            // Show the main vertical line
            box
            .selectAll("vertLines")
            .data(sumstat)
            .enter()
            .append("line")
            .attr("x1", function(d){return(x(d.key))})
            .attr("x2", function(d){return(x(d.key))})
            .attr("y1", function(d){return(y(d.value.min))})
            .attr("y2", function(d){return(y(d.value.max))})
            .attr("stroke", "black")
            .style("width", 40);

            // rectangle for the main box
            var boxWidth = 100;
            box
            .selectAll("boxes")
            .data(sumstat)
            .enter()
            .append("rect")
            .attr("x", function(d){return(x(d.key)-boxWidth/2)})
            .attr("y", function(d){return(y(d.value.percentile_75))})
            .attr("height", function(d){return(y(d.value.percentile_25)-y(d.value.percentile_75))})
            .attr("width", boxWidth )
            .attr("stroke", "black")
            .style("fill", "#346beb")

          // Show the median
            box
            .selectAll("medianLines")
            .data(sumstat)
            .enter()
            .append("line")
            .attr("x1", function(d){return(x(d.key)-boxWidth/2) })
            .attr("x2", function(d){return(x(d.key)+boxWidth/2) })
            .attr("y1", function(d){return(y(d.value.percentile_50))})
            .attr("y2", function(d){return(y(d.value.percentile_50))})
            .attr("stroke", "black")
            .style("width", 80);


          // Add individual points with jitter
          d3.json("static/data/user_long.json", function(data){

          var jitterWidth = 50;
          box
            .selectAll("indPoints")
            .data(data)
            .enter()
            .append("circle")
            .attr("cx", function(d){
              return(x(d.Metric) - jitterWidth/2 + Math.random()*jitterWidth )
            })
            .attr("cy", function(d){return(y(d.Value))})
            .attr("r", 4)
            .style("fill", "white")
            .attr("stroke", "black");

          });
        };

 
  // When the button is changed, run the updateChart function

  function pickMetric (d) {

    // recover the option that has been chosen
    var selectedOption = d3.select(this).property("value")
       console.log(selectedOption)
       for (const obj of sumstat){
          if(obj.key == selectedOption){
            var stat = obj
          }
       };
       var data = sumstat[selectedOption];
       console.log(stat)
       // run the updateChart function with this selected option
      box
       .selectAll("vertLines")
       .remove();

      box
       .selectAll("boxes")
       .remove();

      box
       .selectAll("medianLines")
       .remove();

       genGraph(stat);
  };

  button.on("change", pickMetric);

  genGraph(sumstat);


  });
</script>


</body>
</html>
